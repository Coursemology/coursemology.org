<%= form_for [@course, @assessment, @question], html: { class: 'form-horizontal coding-question-form' } do |f| %>
    <div id="pathstep_content">
      <div class="control-group">
        <%= f.label :title, class: 'control-label' %>
        <div class="controls">
          <%= f.text_field :title, class: 'text_field' %>
        </div>
      </div>
      <div class="control-group">
        <%= f.label :language, class: 'control-label' %>
        <div class="controls">
          <%= f.select :language_id, ProgrammingLanguage.all.map {|l| [l.name, l.id]} , class: 'lang' %>
        </div>
      </div>

      <div class="control-group">
        <%= f.label :max_grade, class: 'control-label' %>
        <div class="controls">
          <%= f.number_field :max_grade, class: 'number_field' %>
        </div>
      </div>

      <div class="control-group">
        <%= f.label :dependent_id, class: 'control-label' %>
        <div class="controls">
          <%- questions = if @question.new_record?
                            @assessment.questions.coding - [@question]
                          else
                            @assessment.questions.coding.before(@question) - [@question]
                          end
              questions = questions.map { |q| [q.specific.title, q.id] }
          %>
          <%= f.select :dependent_id, questions, class: 'select', include_blank: true %>
        </div>
      </div>

      <div class="control-group">
        <%= f.label :description, class: 'control-label' %>
        <div class="controls">
          <%= f.text_area :description, class:'text_area span7 html-editor',:rows => 10 %>
        </div>
      </div>

      <% if @question.persisted? %>
          <div class="control-group">
            <h3>Comments (staff only)</h3>
            <% require 'digest/md5' %>
            <% ecid =  Digest::MD5.hexdigest(@question.class.to_s << @question.id.to_s) %>
            <input type="hidden" id="question_url_<%= ecid %>" value="<%= url_for([@course, @assessment, @submission]) %>">
            <div>
              <%= render partial: "comments/list",
                         locals: { comments:  CommentTopic.comments_to_json(@question.comment_topic, curr_user_course),
                                   target:    @question,
                                   header:    'Comments',
                                   ecid:      ecid
                         } %>
            </div>
          </div>
      <% end %>

      <div class="cos_code path-code" id="path_dooptions">
        <h3>Options</h3>
        <div class="control-group">
          <%= f.label :title,"Step Name", :class => 'control-label' %>
          <div class="controls">
            <%= f.text_field :title, :class => 'text_field' %>
          </div>
        </div>
        <div class="control-group">
          <%= f.label :auto_graded, class: 'control-label' %>
          <div class="controls">
            <%= f.check_box :auto_graded, class: 'checkbox' %>
          </div>
        </div>

        <div class="control-group">
          <%= f.label :memory_limit, 'Memory Limit (MB)', class: 'control-label' %>
          <div class="controls">
            <%= f.number_field :memory_limit, class: 'number_field' %>
          </div>
        </div>

        <div class="control-group">
          <%= f.label :test_limit, 'Test Limit (times)', class: 'control-label' %>
          <div class="controls">
            <%= f.number_field :test_limit, class: 'number_field' %>
          </div>
        </div>

        <div>Pre-filled code:</div><textarea  rows="4" id="prefilled"></textarea>
        <div>Included code (optional, hidden):</div><textarea  rows="2" id="included"></textarea> <br />
      </div>

      <div id="path_testcases">
        <h3>Test Cases</h3>
        <p><strong>NOTE:</strong> The expression in the <strong>'CODE TO RUN'</strong> column will be compared with the expression in the <strong>'EXPECTED OUTOUT'</strong> column using the equality operator. The return value of <code>print()</code> is <code>None</code> and the printed output should not be confused with the return value. </p>
        <div id="public_tests">
          Public Tests: <input type="button" id="add-public-test"  class="btn btn-info pull-right" value="Add New Test"  />
          <table id="public_test" class="table table-bordered test_table">
            <thead>
            <tr>
              <th>
                Code to Run
              </th>
              <th>
                Expected Output
              </th>
              <th class="test-delete-col">
              </th>
            </tr>
            </thead>
            <tbody id="public_test_tbody">
            </tbody>
          </table>
        </div>
        <div id="private_tests">
          Private Tests: <input type="button" id="add-private-test" class="btn btn-info pull-right" value="Add New Test" />
          <table id="private_test" class="table table-bordered test_table">
            <thead>
            <tr>
              <th>
                Code to Run
              </th>
              <th>
                Expected Output
              </th>
              <th class="test-delete-col">
              </th>
            </tr>
            </thead>
            <tbody id="private_test_tbody">
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <%= f.hidden_field :data %>
    <div class="form-actions">
      <%= f.submit nil, :class => 'btn btn-primary', id: 'savePath' %>
      <%= link_to t('.cancel', :default => t("helpers.links.cancel")),
                  url_for([@course, @assessment]), :class => 'btn' %>
    </div>
    </div>
<% end %>
<%= render :partial => "layouts/html_editor" %>

<script type="text/x-tmpl" id="coding-question-form-test-case">
<tr class="test_case" data-test-no="{%= o.test_count %}">
  <td>
    <input type="text" class="code_to_run" value="{%= o.expression %}" data-test-type="{%= o.testType %}" />
  </td>
  <td>
    <input type="text" class="expected_output" value="{%= o.expected %}" data-test-type="{%= o.testType %}" />
  </td>
  <td>
    <a title="Delete this test" class="btn btn-danger delete_test" data-test-type="{%= o.testType %}"><i class="icon-trash"></i></a>
  </td>
</tr>
</script>
