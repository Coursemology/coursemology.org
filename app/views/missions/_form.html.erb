<%= form_for [@course, @mission], :html => { :class => 'form-horizontal' } do |f| %>
    <div class="control-group">
      <%= f.label :title, :class => 'control-label' %>
      <div class="controls">
        <%= f.text_field :title, :class => 'text_field span7' %>
      </div>
    </div>
    <div class="control-group">
      <%= f.label :description, :class => 'control-label' %>
      <div class="controls">
        <%= f.text_area :description, :class => 'text_area span7 html-editor', :rows => 10 %>
      </div>
    </div>
    <div class="control-group">
      <%= f.label :exp, 'EXP', :class => 'control-label' %>
      <div class="controls">
        <%= f.text_field :exp, :class => 'number_field input-medium',id:"mission-exp" %>
      </div>
    </div>
    <div class="control-group">
      <%= f.label :open_at, :class => 'control-label' %>
      <div class="controls">
        <div class="datetimepicker future-only input-append date">
          <%= f.text_field :open_at,
                           :value => datetime_format(@mission.open_at),
                           :class => 'input-medium',
                           id: 'open_at',
                           required: true %>
          <span class="add-on">
          <i data-time-icon="icon-time" data-date-icon="icon-calendar"></i>
        </span>
        </div>
      </div>
    </div>
    <div class="control-group">
      <%= f.label :close_at, :class => 'control-label' %>
      <div class="controls">
        <div class="datetimepicker future-only input-append date">
          <%= f.text_field :close_at,
                           :value => datetime_format(@mission.close_at),
                           :class => 'input-medium',
                           id: 'close_at',
                           required: true %>
          <span class="add-on">
            <i data-time-icon="icon-time" data-date-icon="icon-calendar"></i>
           </span>
        </div>
      </div>
    </div>
    <div class="control-group">
      <%= f.label :publish, 'Publish?', class: 'control-label' %>
      <div class="controls checkbox-text">
        <%= f.check_box :publish %>
      </div>
    </div>
    <div class="control-group">
      <%= f.label :file_submission, 'Allow file submissions?', class: 'control-label' %>
      <div class="controls checkbox-text">
        <%= f.check_box :file_submission %>
      </div>
    </div>

    <div class="control-group">
      <%= f.label :dependent_id, 'Dependency', class: 'control-label' %>
      <div class="controls">
        <%- missions = @missions - [@mission]
            missions = missions.map { |m| [m.title, m.id] }
        %>
        <%= f.select :dependent_id, missions, class: 'select', include_blank: true %>
      </div>
    </div>

    <div class="control-group">
      <%= f.label 'Topics', class: 'control-label' %>
      <div class="controls">
        <%= render partial: 'tags/form_checkboxes',
                   locals: { tag_groups: @course.tag_groups,
                             uncats: @course.tags.uncategorized,
                             exist_tags_hash: @asm_tags } %>
      </div>
    </div>
    <div id="uploaded_files_div"></div>
    <div class="form-actions">
      <%= f.submit nil, :class => 'btn btn-primary', id: 'mission-update', data: {disable_with: 'Submitting...'} %>
      <%= link_to t('.cancel', :default => t('helpers.links.cancel')),
                  @mission.persisted? ? course_assessment_mission_path(@course, @mission) :
                                        course_assessment_missions_path(@course),
                  :class => 'btn' %>
    </div>

    <%= render :partial => 'layouts/html_editor' %>
<% end %>

<h3>Upload mission files</h3>
<%= render partial: 'layouts/file_uploader_complicated',
           locals: { owner: @mission } %>
