<div class="page-header">
  <h1>Survey Statistics: <%= @survey.title %></h1>
</div>

<%= render partial: "nav_bar" %>
<% no_qn = @survey.survey_questions.count %>
<% [@staff_courses, @std_courses, @std_courses_phantom].each_with_index do |user_courses, index| %>
    <% case index  %>
    <% when 0 %>
        <h3>Staff</h3>
    <% when 1 %>
        <h3>All Students</h3>
        <%= button_to "Send Reminder to All", {action: 'reminder_all'}, class:'btn info', data:{ confirm: 'Are you sure you want to send reminder to everyone?', disable_with: 'Loading..' }  %>
    <% when 2 %>
        <h3>Phantom Students </h3>
    <% end %>

    <table class="table">
      <thead>
      <th style="width: 50%">Name</th>
      <th >Status</th>
      <th>Progress</th>
      <th>Action</th>
      </thead>
      <tbody>
      <% user_courses.each do |std| %>
          <% sub = @submissions.select {|sub| sub.user_course == std }.first %>
          <tr>
            <% if sub %>
                <td> <a href="<%= course_survey_survey_submission_path(@course, @survey, sub) %>">  <%= std.name %> </a> </td>
            <% else %>
                <td><%= std.name %></td>
            <% end %>

            <td><%= sub ? sub.status.capitalize : '<span class="not-started">Not Started</span>'.html_safe %></td>
            <td><%= sub ? (sub.answer_count || 0) : 0 %>/ <%= no_qn %></td>
            <% if (sub && sub.answer_count || 0 ) < no_qn  %>
                <td> <%= button_to "Send Reminder", {action: 'reminder', user_id: std.user_id}, class:'btn info', data:{ confirm: 'Are you sure you want to send reminder?', disable_with: 'Loading..' }  %>  </td>
            
            <% end %>
            
          </tr>
      <% end %>
      </tbody>
    </table>
<% end %>

